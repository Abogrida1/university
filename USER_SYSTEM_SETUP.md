# دليل إعداد نظام المستخدمين

## نظرة عامة
تم إنشاء نظام مستخدمين متقدم يدعم:
- تسجيل الدخول والتسجيل للطلاب
- نظام صلاحيات متدرج (طالب، مدير، مدير رئيسي)
- إدارة المستخدمين والصلاحيات
- صفحات شخصية للمستخدمين
- نظام جلسات آمن

## إعداد قاعدة البيانات

### 1. تشغيل ملفات SQL
قم بتشغيل الملفات التالية في Supabase Dashboard بالترتيب:

```sql
-- 1. أولاً، تشغيل الملف الأساسي
database/schema.sql

-- 2. ثم تشغيل نظام المستخدمين
database/user-system-schema.sql
```

### 2. إعداد متغيرات البيئة
تأكد من وجود الملف `.env.local` مع المتغيرات التالية:

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

## الميزات الجديدة

### 1. تسجيل الدخول والتسجيل
- **للطلاب**: يمكنهم إنشاء حساب جديد مع اختيار القسم والسنة والترم
- **للمديرين**: يمكن للمدير الرئيسي إنشاء حسابات مديرين آخرين

### 2. نظام الصلاحيات
- **طالب**: يمكنه الوصول لمواده فقط
- **مدير**: يمكنه إدارة الأقسام والسنوات والفصول
- **مدير رئيسي**: صلاحيات كاملة على النظام

### 3. الصفحات الجديدة
- `/profile` - صفحة الحساب الشخصي
- `/admin` - لوحة الإدارة (للمديرين فقط)

### 4. المكونات الجديدة
- `LoginModal` - نافذة تسجيل الدخول
- `RegisterModal` - نافذة التسجيل
- `UserContext` - إدارة حالة المستخدم
- `UserService` - خدمة إدارة المستخدمين

## الحساب الافتراضي

تم إنشاء حساب مدير رئيسي افتراضي:
- **البريد الإلكتروني**: admin@university.edu
- **كلمة المرور**: password
- **الدور**: مدير رئيسي

⚠️ **مهم**: قم بتغيير كلمة المرور الافتراضية فوراً!

## كيفية الاستخدام

### للطلاب:
1. اضغط على "إنشاء حساب" في الصفحة الرئيسية
2. أدخل بياناتك واختر القسم والسنة والترم
3. سجل دخولك للوصول لموادك

### للمديرين:
1. سجل دخولك بحساب المدير
2. اذهب إلى `/admin` لإدارة المستخدمين
3. يمكنك تغيير أدوار المستخدمين ومنح الصلاحيات

## الأمان

- كلمات المرور مشفرة باستخدام bcrypt
- نظام جلسات آمن مع انتهاء صلاحية
- التحقق من الصلاحيات على مستوى المكونات
- تسجيل أنشطة المستخدمين

## استكشاف الأخطاء

### مشاكل شائعة:
1. **خطأ في تسجيل الدخول**: تأكد من تشغيل ملفات SQL
2. **خطأ في الصلاحيات**: تحقق من إعدادات RLS في Supabase
3. **خطأ في الجلسات**: تأكد من صحة مفاتيح Supabase

### ملفات السجلات:
- تحقق من console في المتصفح للأخطاء
- راجع سجلات Supabase في Dashboard

## التطوير المستقبلي

يمكن إضافة الميزات التالية:
- إشعارات للمستخدمين
- نظام رسائل
- تتبع تقدم الطلاب
- تقارير مفصلة
- API للموبايل

## الدعم

إذا واجهت أي مشاكل، تأكد من:
1. تشغيل جميع ملفات SQL
2. صحة متغيرات البيئة
3. إعدادات RLS في Supabase
4. وجود البيانات في الجداول
